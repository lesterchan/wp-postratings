var $j=jQuery.noConflict();var is_being_rated=false;var postratings_captcha=null;var ratings_mouseover_image;jQuery(function($){ratingsL10n.custom=parseInt(ratingsL10n.custom);ratingsL10n.max=parseInt(ratingsL10n.max);ratingsL10n.show_loading=parseInt(ratingsL10n.show_loading);ratingsL10n.show_fading=parseInt(ratingsL10n.show_fading);ratingsL10n.baseimg=ratingsL10n.plugin_url+"/images/"+ratingsL10n.image+"/rating";ratingsL10n.rtl=parseInt(ratingsL10n.rtl);if(ratingsL10n.custom){ratings_mouseover_image=[];for(var i=1;i<=ratingsL10n.max;i++){ratings_mouseover_image[i]=new Image;ratings_mouseover_image[i].src=ratingsL10n.baseimg+"_"+i+"_over."+ratingsL10n.image_ext}}else{ratings_mouseover_image=new Image;ratings_mouseover_image.src=ratingsL10n.baseimg+"_over."+ratingsL10n.image_ext}$("img[data-votes]").on("mouseover mouseout",current_rating).on("click keypress",rate_post)});function getRtlI(i){return!ratingsL10n.rtl?i:ratingsL10n.max-i+1}function getOver(i){return ratingsL10n.custom?ratings_mouseover_image[getRtlI(i)].src:ratings_mouseover_image.src}function getOn(i){return ratingsL10n.baseimg+(ratingsL10n.custom?"_"+getRtlI(i):"")+"_"+getRtlDir("on")+"."+ratingsL10n.image_ext}function getOff(i){return ratingsL10n.baseimg+(ratingsL10n.custom?"_"+getRtlI(i):"")+"_"+getRtlDir("off")+"."+ratingsL10n.image_ext}function getHalf(i){return ratingsL10n.baseimg+(ratingsL10n.custom?"_"+getRtlI(i):"")+"_"+getRtlDir("half")+"."+ratingsL10n.image_ext}function getRtlDir(name){if(!ratingsL10n.rtl)return name;switch(name){case"on":return"off";case"off":return"on";case"half":return"half-rtl";default:return""}}function is_using_ajax(post_id){return Boolean($j("#post-ratings-"+post_id).data("ajax"))}function non_ajax_hidden_parent(post_id){var parent=$j('input[name="wp_postrating_form_value_'+post_id+'"]');if(parent.length==1)return parent;return false}function current_rating(event){var post_ratings_el=$j(event.target);var post_id=$j(event.target).data("id");var current_rating=$j(event.target).data("currentRating");var rating_score=$j(event.target).data("votes");var insert_half=$j(event.target).data("half");if(is_being_rated)return;var curval=NaN;if(!is_using_ajax(post_id)){var $parent=non_ajax_hidden_parent(post_id);curval=parseInt($parent.val())}var next_images=[];function setOn(i){next_images[i]=getOn(i)}function setOff(i){next_images[i]=getOff(i)}function setHalf(i){next_images[i]=getHalf(i)}function setOver(i){next_images[i]=getOver(i)}var max=ratingsL10n.max;var i;for(i=1;i<=max;i++)setOff(i);for(i=1;i<=current_rating;i++)setOn(i);if(insert_half>rating_score)setHalf(insert_half);if(!isNaN(curval)){if(event.type=="mouseover")for(i=1;i<=Math.min(curval,rating_score);i++)setOver(i);else for(i=1;i<=curval;i++)setOver(i)}if(event.type=="mouseover")for(i=1;i<=rating_score;i++)setOver(i);for(i=1;i<=max;i++)$j("#rating_"+post_id+"_"+i).attr("src",next_images[i]);updateText($j("#ratings_"+post_id+"_text"),post_ratings_el,event.type=="mouseout")}function updateText($text_el,$element,mouseout){if($text_el.length){if(mouseout)$text_el.hide().empty();else $text_el.html($element.data("ratingsText")).show()}}function rate_post_success(post_id,data){$j("#post-ratings-"+post_id).html(data);if(ratingsL10n.show_loading){$j("#post-ratings-"+post_id+"-loading").hide()}if(ratingsL10n.show_fading){$j("#post-ratings-"+post_id).fadeTo("def",1)}}function rate_post(event){var post_ratings_el=$j(event.target);var post_id=$j(event.target).data("id");var post_rating=$j(event.target).data("votes");var captcha_response="";if(!is_using_ajax(post_id)){var value_holder=non_ajax_hidden_parent(post_id);var curval=$j(value_holder).val();$j(value_holder).val(null);$j("#rating_"+post_id+"_"+curval).trigger("mouseout");if(curval!=post_rating){$j("#rating_"+post_id+"_"+post_rating).trigger("mouseover");$j(value_holder).val(post_rating)}return}if(ratingsL10n.captcha_sitekey&&ratingsL10n.captcha_sitekey.length){if(postratings_captcha===null){postratings_captcha=grecaptcha.render("g-recaptcha-response",{sitekey:ratingsL10n.captcha_sitekey});return}else{captcha_response=grecaptcha.getResponse(postratings_captcha);if(!grecaptcha.getResponse(postratings_captcha)){return}else{$j("#g-recaptcha-response").remove()}}}if(!is_being_rated){var post_ratings_nonce=$j(post_ratings_el).parent(".post-ratings").data("nonce");is_being_rated=true;if(ratingsL10n.show_fading){$j(post_ratings_el).fadeTo("def",0,function(){if(ratingsL10n.show_loading){$j("#post-ratings-"+post_id+"-loading").show()}})}else{if(ratingsL10n.show_loading){$j("#post-ratings-"+post_id+"-loading").show()}}$j.post({xhrFields:{withCredentials:true},dataType:"html",url:ratingsL10n.ajax_url,data:"action=postratings&pid="+post_id+"&rate="+post_rating+"&postratings_"+post_id+"_nonce="+post_ratings_nonce+"&g-recaptcha-response="+captcha_response,cache:false}).done(function(data){rate_post_success(post_id,data)}).always(function(){is_being_rated=false})}else{alert(ratingsL10n.text_wait)}}